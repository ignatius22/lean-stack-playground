<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Test - Monaco Editor</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a2e;
      color: #fff;
      font-family: monospace;
    }
    #editor {
      width: 800px;
      height: 600px;
      border: 2px solid #6c5ce7;
    }
    button {
      padding: 10px 20px;
      margin: 10px 0;
      font-size: 16px;
      cursor: pointer;
    }
    #output {
      margin-top: 20px;
      padding: 10px;
      background: #2a2a3e;
      border: 1px solid #6c5ce7;
      min-height: 100px;
    }
  </style>
</head>
<body>
  <h1>üß™ Simple Monaco Test</h1>
  <p>If you see a code editor below, Monaco is working!</p>

  <div id="status">Loading Monaco...</div>

  <div id="editor"></div>

  <button onclick="runCode()">Run Code</button>
  <button onclick="testIframe()">Test Iframe</button>

  <div id="output"></div>

  <!-- Monaco Editor -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script>
    let editor;

    require.config({
      paths: {
        vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs'
      }
    });

    require(['vs/editor/editor.main'], function() {
      document.getElementById('status').textContent = '‚úÖ Monaco loaded! Creating editor...';

      try {
        editor = monaco.editor.create(document.getElementById('editor'), {
          value: 'console.log("Hello from Monaco!");\nconsole.log("Testing 123");',
          language: 'javascript',
          theme: 'vs-dark',
          minimap: { enabled: false }
        });

        document.getElementById('status').textContent = '‚úÖ Editor created successfully!';
        console.log('Editor created:', editor);
      } catch (e) {
        document.getElementById('status').textContent = '‚ùå Error: ' + e.message;
        console.error(e);
      }
    });

    function runCode() {
      if (!editor) {
        alert('Editor not ready yet!');
        return;
      }

      const code = editor.getValue();
      const output = document.getElementById('output');
      output.innerHTML = '<strong>Running code...</strong><br>';

      // Create iframe to run code
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.sandbox = 'allow-scripts allow-same-origin';
      document.body.appendChild(iframe);

      const doc = iframe.contentWindow.document;

      const html = `
        <!DOCTYPE html>
        <html>
        <head><meta charset="UTF-8"></head>
        <body>
          <script>
            const originalLog = console.log;
            console.log = function(...args) {
              originalLog.apply(console, args);
              window.parent.postMessage({
                type: 'log',
                message: args.join(' ')
              }, '*');
            };

            try {
              ${code}
            } catch (e) {
              window.parent.postMessage({
                type: 'error',
                message: e.message
              }, '*');
            }
          <\/script>
        </body>
        </html>
      `;

      window.addEventListener('message', function(e) {
        if (e.data.type === 'log') {
          output.innerHTML += 'üìù ' + e.data.message + '<br>';
        } else if (e.data.type === 'error') {
          output.innerHTML += '‚ùå ' + e.data.message + '<br>';
        }
      });

      doc.open();
      doc.write(html);
      doc.close();

      setTimeout(() => {
        output.innerHTML += '<strong>‚úÖ Done!</strong>';
        iframe.remove();
      }, 1000);
    }

    function testIframe() {
      const output = document.getElementById('output');
      output.innerHTML = '<strong>Testing iframe...</strong><br>';

      try {
        const iframe = document.createElement('iframe');
        iframe.sandbox = 'allow-scripts allow-same-origin';
        iframe.style.display = 'none';
        document.body.appendChild(iframe);

        output.innerHTML += '‚úÖ Iframe created<br>';

        const doc = iframe.contentWindow.document;
        output.innerHTML += '‚úÖ Got document<br>';

        doc.write('<html><body><script>console.log("Iframe works!");<\/script></body></html>');
        output.innerHTML += '‚úÖ Wrote to document<br>';

        doc.close();
        output.innerHTML += '‚úÖ Closed document<br>';

        setTimeout(() => {
          iframe.remove();
          output.innerHTML += '‚úÖ Iframe test complete!<br>';
        }, 500);

      } catch (e) {
        output.innerHTML += '‚ùå Error: ' + e.message + '<br>';
        console.error(e);
      }
    }
  </script>
</body>
</html>
